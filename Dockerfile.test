FROM python:3.13-slim

WORKDIR /workspace

RUN apt-get update \
    && apt-get install -y --no-install-recommends \
        build-essential \
        ca-certificates \
        curl \
        git \
        gzip \
        hashcat \
        ocl-icd-libopencl1 \
        pocl-opencl-icd \
        p7zip-full \
        transmission-cli \
    && rm -rf /var/lib/apt/lists/*

RUN python -m pip install -q uv==0.9.28

COPY . /workspace

RUN make submodules vendor-assets && uv tool install . && make clean-vendor

ENV PATH="${HOME}/.local/bin:${PATH}"
ENV HATE_CRACK_SKIP_INIT=1

CMD ["bash", "-lc", "${HOME}/.local/bin/hate_crack --help >/tmp/hc_help.txt && ./hate_crack.py --help >/tmp/hc_script_help.txt"]
